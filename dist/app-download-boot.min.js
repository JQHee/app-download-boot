var appDownloadBoot=function(){function t(t){this.isWeixin=!!/MicroMessenger/gi.test(navigator.userAgent),this.isAndroid=!!navigator.userAgent.match(/android/gi),this.isIos=!!navigator.userAgent.match(/(iphone|ipod|ios|ipad)/gi),this.iosVersion=this.getIosVersion(),this.opts=this.concatOptions(t),this.createIosMeta()}return t.prototype.concatOptions=function(t){t=t instanceof Object?t:{};var o={};for(var i in t)o[i]=t[i];var e={android:{file:null,schema:null,yyb:null},ios:{appid:null,schema:null,appstore:null},site:null,url:null};for(var s in e)if(o[s]||(this.opts.callback&&this.opts.callback({code:1,msg:s+" 未配置"}),o[s]=e[s]),e[s]instanceof Object)for(var a in e[s]){var c=e[s][a];try{o[s][a]||(this.opts.callback&&this.opts.callback({code:2,msg:s+"属性"+a+" 未配置"}),o[s][a]=c)}catch(t){}}return o},t.prototype.download=function(){var t=this;if(!this.isAndroid&&!this.isIos)return this.opts.callback&&this.opts.callback({code:7,msg:"非移动设备"}),void(window.location.href=this.opts.url);var o=this.opts.android||{},i=this.opts.ios||{};if(this.isAndroid)this.tryStarting(o.schema,function(i){i.code>0&&(t.isWeixin?window.location.href=o.yyb:t.createIframe(o.file,function(t){t.code>0&&(window.location.href=this.opts.site)}))}),this.opts.callback&&this.opts.callback({code:5,msg:"andriod设备"});else if(this.isIos){if(this.iosVersion>=9){window.location.href=this.opts.url?i.schema+"?url="+this.opts.url:i.schema;var e=setTimeout(function(){window.alert("即将进入appStore！"),window.location.href=i.appstore,clearTimeout(e)},500);return}this.tryStarting(i.schema,function(t){t.code>0&&(window.location.href=i.appstore)}),this.opts.callback&&this.opts.callback({code:6,msg:"ios设备"})}},t.prototype.tryStarting=function(t,o){var i=this;t?(this.createIframe(t,function(e){o&&o(e),0===e.code?i.opts.callback&&i.opts.callback({code:3,msg:"启动App成功"}):i.opts.callback&&i.opts.callback({code:4,msg:"启动App失败 "+t})}),this.opts.callback&&this.opts.callback({code:8,msg:"尝试启动app: "+t})):this.opts.callback&&this.opts.callback({code:9,msg:"未配置schema协议"})},t.prototype.getIosVersion=function(){return/OS (\d+)/gi.test(navigator.userAgent)?RegExp.$1:0},t.prototype.createIosMeta=function(){if(this.isIos){var t=this.opts.ios.appid,o=document.createElement("meta");o.setAttribute("name","apple-itunes-app"),o.setAttribute("content","app-id='"+t+"', affiliate-data=myAffiliateData, app-argument='"+t+"'"),document.querySelector("head").appendChild(o)}},t.prototype.createIframe=function(t,o){var i=document.createElement("iframe");i.style.cssText="display:none;width=0;height=0",i.src=t,document.body.appendChild(i);var e=setTimeout(function(){o&&o({code:2,msg:"overtime"}),clearTimeout(e)},3e3);i.onload=function(){clearTimeout(e),o&&o({code:0,msg:"success"})},i.onerror=function(){clearTimeout(e),o&&o({code:1,msg:"error"})};var s=setTimeout(function(){document.body.removeChild(i),clearTimeout(s)},1500)},t}();