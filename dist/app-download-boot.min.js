!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&(define.amd||define.cmd)?define(i):t.appDownloadBoot=i()}(this,function(){"use strict";return function(){function t(t){this.isWeixin=!!/MicroMessenger/gi.test(navigator.userAgent),this.isAndroid=!!navigator.userAgent.match(/android/gi),this.isIos=!!navigator.userAgent.match(/(iphone|ipod|ios|ipad)/gi),this.opts=this.concatOptions(t),this.isIos&&this.createIosMeta()}return t.prototype.concatOptions=function(t){t=t instanceof Object?t:{};var i={};for(var o in t)i[o]=t[o];var s={android:{file:null,schema:null,yyb:null},ios:{appid:null,schema:null,appstore:null},site:null,url:null};for(var e in s)if(i[e]||(this.opts.callback&&this.opts.callback({code:1,msg:e+" 未配置"}),i[e]=s[e]),s[e]instanceof Object)for(var a in s[e]){var n=s[e][a];try{i[e][a]||(this.opts.callback&&this.opts.callback({code:2,msg:e+"属性"+a+" 未配置"}),i[e][a]=n)}catch(t){}}return i},t.prototype.download=function(){var t=this;if(!this.isAndroid&&!this.isIos)return this.opts.callback&&this.opts.callback({code:7,msg:"非移动设备"}),void(window.location.href=this.opts.url);var i=this.opts.android||{},o=this.opts.ios||{};this.isAndroid?(this.tryStarting(i.schema,function(o){o||(window.location.href=t.isWeixin?i.yyb:i.file)}),this.opts.callback&&this.opts.callback({code:5,msg:"andriod设备"})):this.isIos&&(this.tryStarting(o.schema,function(t){t||(window.location.href=o.appstore)}),this.opts.callback&&this.opts.callback({code:6,msg:"ios设备"}))},t.prototype.tryStarting=function(t,i){var o=this;if(t){var s=document.createElement("iframe");s.style.cssText="display:none;width=0;height=0",s.src=t+"?url="+this.opts.url,s.onload=function(){i&&i(!0),o.opts.callback&&o.opts.callback({code:3,msg:"启动App成功"})},s.onerror=function(){i&&i(!1),o.opts.callback&&o.opts.callback({code:4,msg:"启动App失败"})},document.body.appendChild(s);var e=setTimeout(function(){document.body.removeChild(s),clearTimeout(e)},1e3);this.opts.callback&&this.opts.callback({code:8,msg:"尝试启动app: "+s.src})}else this.opts.callback&&this.opts.callback({code:9,msg:"未配置schema协议"})},t.prototype.createIosMeta=function(){var t=this.opts.ios.appid,i=document.createElement("meta");i.setAttribute("name","apple-itunes-app"),i.setAttribute("content","app-id='"+t+"', affiliate-data=myAffiliateData, app-argument='"+t+"'"),document.querySelector("head").appendChild(i)},t}()});